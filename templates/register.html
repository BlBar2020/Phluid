<!-- Extend the base template -->
{% extends 'base.html' %}

{% load extra_filters %}

<!-- Define the content block -->
{% block content %}

<!-- Inline CSS for styling the form and buttons -->
<style>
  body, html {
      height: 100%;
      margin: 0;
  }

  /* Style the container for the registration form */
  .register-container {
      margin: 0 auto;
      width: 50%;
      padding: 20px;
  }

  .register-card {
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 12px; /* Rounded corners for the card */
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
  }

  .register-card-header {
      background-color: #5431B2;
      color: white;
      font-size: 16px;
      display: flex;
      align-items: center;
      padding: 10px;
      justify-content: start;
  }

  .register-card-body {
      padding: 20px;
  }

  /* Ensure all form fields span the full width and have rounded corners */
  .form-control {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 30px; /* Larger border-radius for more oval shape */
      margin-bottom: 15px;
  }

  .helptext {
      font-size: 12px;
      color: #666;
      margin-top: -10px;
      margin-bottom: 15px;
  }

  /* Style the "Already Registered?" section */
  .already-registered {
      margin-bottom: 20px; /* Add padding below the "Already registered" link */
      text-align: left; /* Align the link to the left */
  }

  /* Center the register button and style it */
  .register-btn {
      display: block;
      background-color: #5431B2;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 30px;  /* Larger rounded corners for button */
      text-align: center;
      cursor: pointer;
      margin: 20px auto 0; /* Center the button */
      width: auto;
  }

  /* Change button color on hover */
  .register-btn:hover {
      background-color: #FFC617;
      color: #5431B2;
  }

  /* Password requirements style */
  #passwordRequirements {
      margin-top: 10px; /* Add spacing between the password fields and requirements */
      margin-bottom: 20px;
  }

  #passwordRequirements p {
      color: red;
      margin: 0;
      font-size: 14px;
  }
</style>

<!-- Registration form -->
<div class="register-card">
    <div class="register-card-header">Register</div>
    <div class="register-card-body">
        <!-- If there are any messages, display them -->
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}

        <div class="already-registered">
            Already registered? <a href="{% url 'login' %}">Log In</a>
        </div>

        <!-- Registration form -->
        <form method="post" id="registrationForm">
            {% csrf_token %}

            <!-- Full-width first name field -->
            <div class="form-group">
                {{ user_form.first_name.label_tag }}
                {{ user_form.first_name|add_class:"form-control" }}  <!-- Apply add_class only to the form field -->
            </div>

            <!-- Full-width last name field -->
            <div class="form-group">
                {{ user_form.last_name.label_tag }}
                {{ user_form.last_name|add_class:"form-control" }}   <!-- Apply add_class only to the form field -->
            </div>

            <!-- Full-width username field -->
            <div class="form-group">
                {{ user_form.username.label_tag }}
                {{ user_form.username|add_class:"form-control" }}    <!-- Apply add_class only to the form field -->
                <div class="helptext">{{ user_form.username.help_text }}</div>   <!-- Username requirements displayed below -->
            </div>

            <!-- Full-width email field -->
            <div class="form-group">
                {{ user_form.email.label_tag }}
                {{ user_form.email|add_class:"form-control" }}  <!-- Apply add_class only to the form field -->
            </div>

            <!-- Full-width password field -->
            <div class="form-group">
                {{ user_form.password1.label_tag }}
                {{ user_form.password1|add_class:"form-control" }}   <!-- Apply add_class only to the form field -->
            </div>

            <!-- Password requirements displayed directly under the first password field -->
            <div id="passwordRequirements">
                <p id="reqSpecialChar">Contains a special character (e.g., !@#$%^&*)</p>
                <p id="reqCapitalLetter">Contains a capital letter</p>
                <p id="reqNumber">Contains a number</p>
                <p id="passwordMatchMessage">Passwords match.</p>
            </div>

            <!-- Full-width confirm password field -->
            <div class="form-group">
                {{ user_form.password2.label_tag }}
                {{ user_form.password2|add_class:"form-control" }}   <!-- Apply add_class only to the form field -->
            </div>

            <!-- Full-width city field -->
            <div class="form-group">
                {{ profile_form.city.label_tag }}
                {{ profile_form.city|add_class:"form-control" }}   <!-- Apply add_class only to the form field -->
            </div>

            <!-- Full-width state field -->
            <div class="form-group">
                {{ profile_form.state.label_tag }}
                {{ profile_form.state|add_class:"form-control" }}   <!-- Apply add_class only to the form field -->
            </div>

            <!-- Full-width financial goals field -->
            <div class="form-group">
                {{ profile_form.financial_goals.label_tag }}
                {{ profile_form.financial_goals|add_class:"form-control" }}   <!-- Apply add_class only to the form field -->
            </div>

            <!-- Additional profile fields -->
            <div class="form-group">
                {{ profile_form.experience_level.label_tag }}
                {{ profile_form.experience_level|add_class:"form-control" }}
            </div>

            <div class="form-group">
                {{ profile_form.risk_tolerance.label_tag }}
                {{ profile_form.risk_tolerance|add_class:"form-control" }}
            </div>

            <div class="form-group">
                {{ profile_form.income_level.label_tag }}
                {{ profile_form.income_level|add_class:"form-control" }}
            </div>

            <div class="form-group">
                {{ profile_form.has_dependents.label_tag }}
                {{ profile_form.has_dependents|add_class:"form-control" }}
            </div>

            <div class="form-group">
                {{ profile_form.savings_months.label_tag }}
                {{ profile_form.savings_months|add_class:"form-control" }}
            </div>

            <!-- Submit button centered -->
            <button type="submit" class="register-btn">Register</button>
        </form>
    </div>
</div>

<!-- Script to handle password strength and matching -->
<script>
    function checkPasswordStrengthAndMatch() {
        const password = document.getElementById("id_password1").value;
        const confirmPassword = document.getElementById("id_password2").value;

        const reqSpecialChar = document.getElementById("reqSpecialChar");
        const reqCapitalLetter = document.getElementById("reqCapitalLetter");
        const reqNumber = document.getElementById("reqNumber");
        const passwordMatchMessage = document.getElementById("passwordMatchMessage");

        reqSpecialChar.style.color = /[!@#$%^&*(),.?":{}|<>]/.test(password) ? 'green' : 'red';
        reqCapitalLetter.style.color = /[A-Z]/.test(password) ? 'green' : 'red';
        reqNumber.style.color = /[0-9]/.test(password) ? 'green' : 'red';
        passwordMatchMessage.style.color = password === confirmPassword ? 'green' : 'red';
        passwordMatchMessage.textContent = password === confirmPassword ? 'Passwords match.' : 'Passwords do not match.';
    }

    document.getElementById("id_password1").addEventListener("keyup", checkPasswordStrengthAndMatch);
    document.getElementById("id_password2").addEventListener("keyup", checkPasswordStrengthAndMatch);
</script>

{% endblock %}