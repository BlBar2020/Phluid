<!-- Extend the base HTML layout -->
{% extends 'base.html' %}

{% load extra_filters %}

<!-- Define the content block -->
{% block content %}

<!-- Inline CSS for styling the form and buttons -->
<style>
    body, html {
        height: 100%;
        margin: 0;
    }

    /* Style the container for the profile update form */
    .update-profile-container {
        margin: 0 auto;
        width: 50%;
        padding: 20px;
    }

    .update-profile-card {
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 12px; /* Slightly larger border-radius for the card */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }

    .update-profile-card-header {
        background-color: #5431B2;
        color: white;
        font-size: 16px;
        display: flex;
        align-items: center;
        padding: 10px;
        justify-content: start;
    }

    .update-profile-card-body {
        padding: 20px;
    }

    /* Ensure all form fields span the full width and have more rounded corners */
    .form-control {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 30px; /* Larger border-radius for more oval shape */
        margin-bottom: 15px;
    }

    .helptext {
        font-size: 12px;
        color: #666;
        margin-top: -10px;
        margin-bottom: 15px;
    }

    /* Buttons container for placing buttons next to each other */
    .form-buttons {
        display: flex;
        justify-content: flex-start; /* Align buttons next to each other */
        gap: 5px; /* Add 5px space between buttons */
        margin-top: 20px;
    }

    /* Style the submit and close buttons with rounded corners */
    .submit-btn, .close-btn {
        background-color: #5431B2;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 30px;  /* Larger rounded corners for buttons */
        text-align: center;
        cursor: pointer;
    }

    /* Ensure buttons don't span across the entire page */
    .submit-btn, .close-btn {
        width: auto;
    }

    /* Change button color on hover */
    .submit-btn:hover, .close-btn:hover {
        background-color: #FFC617;
        color: #5431B2;
    }

    /* Password requirements style with additional padding */
    #passwordRequirements {
        margin-bottom: 20px;
    }

    #passwordRequirements p {
        color: red;
        margin: 0;
        font-size: 14px;
    }
</style>

<!-- Profile update form -->
<div class="update-profile-card">
    <div class="update-profile-card-header">Update Profile</div>
    <div class="update-profile-card-body">
        <!-- Start the form, set method to POST and disable autocomplete -->
        <form method="post" autocomplete="off">
            <!-- Add CSRF token for security -->
            {% csrf_token %}

            <!-- Display user's current first name, last name, and date of birth (read-only) -->
            <p>First Name: {{ user.first_name }}</p>
            <p>Last Name: {{ user.last_name }}</p>
            <p>Date of Birth: {{ date_of_birth|date:"Y-m-d" }}</p>

            <!-- Full-width username field -->
            <div class="form-group">
                {{ user_form.username.label_tag }}
                {{ user_form.username|add_class:"form-control" }}
                <div class="helptext">{{ user_form.username.help_text }}</div>
            </div>

            <!-- Full-width email field -->
            <div class="form-group">
                {{ user_form.email.label_tag }}
                {{ user_form.email|add_class:"form-control" }}
            </div>

            <!-- Full-width password fields -->
            <div class="form-group">
                {{ user_form.password1.label_tag }}
                {{ user_form.password1|add_class:"form-control" }}
            </div>

            <div class="form-group">
                {{ user_form.password2.label_tag }}
                {{ user_form.password2|add_class:"form-control" }}
            </div>

            <!-- Password requirements displayed directly under password fields -->
            <div id="passwordRequirements">
                <p id="reqSpecialChar">Contains a special character (e.g., !@#$%^&*)</p>
                <p id="reqCapitalLetter">Contains a capital letter</p>
                <p id="reqNumber">Contains a number</p>
                <p id="passwordMatchMessage">Passwords match.</p>
            </div>

            <!-- Render profile form fields (city, state, financial goals, etc.) with custom labels -->
            {{ profile_form.as_p }}

            <!-- Form buttons (submit and close) displayed side by side with 5px gap -->
            <div class="form-buttons">
                <button type="submit" class="submit-btn">Update Profile</button>
                <button type="button" class="close-btn" onclick="window.location.href='/'">Close</button>
            </div>
        </form>
    </div>
</div>

<!-- Script to handle password strength and matching -->
<script>
    function checkPasswordStrengthAndMatch() {
        const password = document.getElementById("id_password1").value;
        const confirmPassword = document.getElementById("id_password2").value;

        const reqSpecialChar = document.getElementById("reqSpecialChar");
        const reqCapitalLetter = document.getElementById("reqCapitalLetter");
        const reqNumber = document.getElementById("reqNumber");
        const passwordMatchMessage = document.getElementById("passwordMatchMessage");

        reqSpecialChar.style.color = /[!@#$%^&*(),.?":{}|<>]/.test(password) ? 'green' : 'red';
        reqCapitalLetter.style.color = /[A-Z]/.test(password) ? 'green' : 'red';
        reqNumber.style.color = /[0-9]/.test(password) ? 'green' : 'red';
        passwordMatchMessage.style.color = password === confirmPassword ? 'green' : 'red';
        passwordMatchMessage.textContent = password === confirmPassword ? 'Passwords match.' : 'Passwords do not match.';
    }

    document.getElementById("id_password1").addEventListener("keyup", checkPasswordStrengthAndMatch);
    document.getElementById("id_password2").addEventListener("keyup", checkPasswordStrengthAndMatch);
</script>

{% endblock %}